!function(a){a.fn.playback=function(){var b,c=function(){e(b),b.removeClass("active"),b.data("audio").off("ended timeupdate"),b=null},d=function(a){a.width(this.currentTime/this.duration*100+"%")},e=function(a){a.data("progress").width(0).parent().removeClass("on");var b=a.data("audio").off("ended timeupdate");b[0].pause(),b[0].currentTime=0};return this.each(function(){var f=a(this),g=a(f.data("progress")),h=f.find("audio");f.data("progress",g).data("audio",h),e(f),f.click(function(){if(b){if(e(b),b===f)return void(b=null);b.removeClass("active")}b=f,g.width(0).parent().addClass("on"),h.on("ended",c),h.on("timeupdate",d.bind(h[0],g)),h[0].play()})})}}(jQuery),function(a){a.fn.tagSearch=function(b){return this.each(function(){var c=a(this),d=a(b.list),e=d.find("ul").on("click",".search-item",function(){d.removeClass("open"),b.selected(a(this).data("tag")),b.autoClear&&f()}),f=function(){c.val(""),e.empty(),d.removeClass("open")},g=function(f){if(f)if(d.addClass("open"),f.length){for(var g,h=[],i=c.val(),j=0;j<f.length;j++){var k=f[j];g=a("<li><button class='btn btn-link search-item'></button></li>"),g.find("button").html("#"+k.name.replace(i,"<strong>"+i+"</strong>")).data("tag",k),h.push(g)}e.html(h)}else e.html("<li class='empty'>"+b.empty+"</li>")};c.keydown(function(a){13==a.keyCode&&a.preventDefault()}).keyup(function(c){var d=e.find(".active");38==c.keyCode?(d.length&&d.removeClass("active").prev().addClass("active"),c.preventDefault()):40==c.keyCode?(d.length?d.removeClass("active").next().addClass("active"):e.find("li:first").addClass("active"),c.preventDefault()):13==c.keyCode?d.length?(d.find(".search-item").click(),c.preventDefault()):b.enterPress&&this.value&&(b.enterPress.call(this),c.preventDefault(),f()):this.value?(this.value=this.value.toLowerCase(),a.post(b.service,{search:this.value},g)):f()}).focus(function(){e.find("li").length&&d.addClass("open")}).blur(function(b){a(b.relatedTarget).hasClass("search-item")||d.removeClass("open")})})}}(jQuery),function(){$(".toggle").on("click",function(){$(this).toggleClass("active")}),$(".favorite").click(function(){$.post("/favorites",{id:$(this).data("id")},function(a){})}),$(".sample-audio").playback(),$("#search").tagSearch({list:"#search-list",service:"/search",empty:"（。々°）",selected:function(a){document.location.href="/tag/"+a.uri}})}();